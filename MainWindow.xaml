<Window x:Class="DeadDailyDose.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Dead Daily Dose" Height="700" Width="800"
        MinHeight="580" MinWidth="700"
        WindowStartupLocation="CenterScreen"
        Background="{StaticResource BrushBackground}">
    <Grid Margin="20,12,20,16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Menu -->
        <Menu Grid.Row="0" Margin="0,0,0,12" Style="{StaticResource MenuStyle}">
            <MenuItem Header="_File">
                <MenuItem Header="_Refresh Show" Command="{Binding RefreshCommand}"/>
                <MenuItem Header="Set _API Key..." Command="{Binding SetApiKeyCommand}"/>
                <Separator/>
                <MenuItem Header="E_xit" Click="Exit_Click"/>
            </MenuItem>
        </Menu>

        <!-- Artist selection -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,12">
            <TextBlock Text="Artist:" Style="{StaticResource LabelStyle}" Margin="0,0,10,0" Width="42"/>
            <ComboBox x:Name="ArtistComboBox" Style="{StaticResource ComboBoxStyle}"
                      ItemsSource="{Binding ArtistsList}"
                      SelectedItem="{Binding SelectedArtist, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                      MinWidth="200" Margin="0,0,16,0"/>
            <CheckBox Content="Randomize artist on refresh" Style="{StaticResource CheckBoxStyle}"
                      IsChecked="{Binding RandomizeArtistOnRefresh, Mode=TwoWay}"/>
        </StackPanel>

        <!-- Show of the day (card) -->
        <Border Grid.Row="2" Background="{StaticResource BrushSurface}" BorderBrush="{StaticResource BrushBorderSubtle}"
                BorderThickness="1" CornerRadius="8" Padding="16,14" Margin="0,0,0,12" MinHeight="56">
            <TextBlock x:Name="ShowLabel" Text="{Binding ShowOfTheDayLabel}"
                       Foreground="{StaticResource BrushTextPrimary}"
                       FontFamily="{StaticResource FontFamilyPrimary}" FontSize="16" FontWeight="SemiBold"
                       TextWrapping="Wrap" VerticalAlignment="Center"/>
        </Border>

        <!-- Setlist (visible only when setlist.fm API key is set) -->
        <GroupBox Grid.Row="3" Header="Setlist" Style="{StaticResource GroupBoxStyle}"
                  Visibility="{Binding IsSetlistVisible, Converter={StaticResource BoolToVisibility}}">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
                <StackPanel>
                    <TextBlock x:Name="SetlistBlock" Text="{Binding SetlistText}" TextWrapping="Wrap"
                               Margin="4" FontSize="13" Foreground="{StaticResource BrushTextPrimary}"/>
                </StackPanel>
            </ScrollViewer>
        </GroupBox>

        <!-- Tracks (fixed-height scrollable list) -->
        <GroupBox Grid.Row="4" Header="Tracks" Style="{StaticResource GroupBoxStyle}">
            <ListBox x:Name="TracksListBox" Style="{StaticResource ListBoxStyle}"
                     ItemContainerStyle="{StaticResource ListBoxItemStyle}"
                     ItemsSource="{Binding Tracks}"
                     DisplayMemberPath="DisplayText"
                     SelectedIndex="{Binding SelectedTrackIndex, Mode=TwoWay}"
                     SelectionChanged="TracksListBox_SelectionChanged"
                     Height="220" ScrollViewer.VerticalScrollBarVisibility="Auto"
                     ScrollViewer.HorizontalScrollBarVisibility="Disabled"/>
        </GroupBox>

        <!-- Search by date -->
        <StackPanel Grid.Row="5" Orientation="Horizontal" Margin="0,0,0,12">
            <TextBlock Text="Search by date (MM-DD):" Style="{StaticResource LabelStyle}" Margin="0,0,10,0"/>
            <TextBox x:Name="ManualDateTextBox" Style="{StaticResource TextBoxStyle}" Width="88" Margin="0,0,10,0"
                     Text="{Binding ManualDateInput, UpdateSourceTrigger=PropertyChanged}"/>
            <Button Content="Go" Command="{Binding SearchByDateCommand}" Style="{StaticResource SecondaryButtonStyle}" Padding="16,8"/>
        </StackPanel>

        <!-- Playback bar -->
        <Border Grid.Row="6" Background="{StaticResource BrushSurfaceRaised}" BorderBrush="{StaticResource BrushBorderSubtle}"
                BorderThickness="1" CornerRadius="8" Padding="16,14">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Center">
                    <Button x:Name="PlayPauseButton" Content="{Binding PlayPauseButtonText}" Command="{Binding PlayPauseCommand}"
                            Click="PlayPauseButton_Click" Style="{StaticResource PrimaryButtonStyle}" Margin="0,0,6,0"/>
                    <Button Content="Stop" Command="{Binding StopCommand}" Style="{StaticResource SecondaryButtonStyle}" Margin="4,0"/>
                    <Button Content="Previous" Command="{Binding PreviousTrackCommand}" Style="{StaticResource SecondaryButtonStyle}" Margin="4,0"/>
                    <Button Content="Next" Command="{Binding NextTrackCommand}" Style="{StaticResource SecondaryButtonStyle}" Margin="4,0"/>
                    <TextBlock Text="Repeat:" Style="{StaticResource LabelStyle}" Margin="16,0,6,0" VerticalAlignment="Center"/>
                    <ComboBox ItemsSource="{Binding RepeatModeOptions}" SelectedItem="{Binding RepeatMode, Mode=TwoWay}"
                              Style="{StaticResource ComboBoxStyle}" MinWidth="100" Margin="0,0,0,0"
                              ItemTemplate="{StaticResource RepeatModeItemTemplate}"/>
                </StackPanel>
                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,12,0,0">
                    <TextBlock Text="Volume:" Style="{StaticResource LabelStyle}" Margin="0,0,8,0" Width="48"/>
                    <Slider x:Name="VolumeSlider" Style="{StaticResource SliderStyle}" Width="90" Minimum="0" Maximum="1" Value="0.8" TickFrequency="0.1" Margin="0,0,20,0"/>
                    <TextBlock Text="Seek:" Style="{StaticResource LabelStyle}" Margin="0,0,8,0" Width="36"/>
                    <Slider x:Name="SeekSlider" Style="{StaticResource SliderStyle}" Minimum="0" Maximum="1" Value="0" Width="140"
                            Margin="0,0,20,0" ValueChanged="SeekSlider_ValueChanged"
                            MouseDown="SeekSlider_MouseDown" MouseUp="SeekSlider_MouseUp"/>
                    <TextBlock Text="{Binding Status}" Style="{StaticResource LabelStyle}" Margin="12,0,0,0"
                               TextTrimming="CharacterEllipsis" MaxWidth="260" Foreground="{StaticResource BrushTextMuted}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Hidden MediaElement for playback -->
        <MediaElement x:Name="MediaElement" LoadedBehavior="Manual" Visibility="Collapsed"
                      MediaOpened="MediaElement_MediaOpened" MediaEnded="MediaElement_MediaEnded"/>

        <!-- Loading indicator -->
        <ProgressBar Grid.Row="0" Grid.RowSpan="7" x:Name="ProgressBar"
                     IsIndeterminate="True"
                     Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibility}}"
                     VerticalAlignment="Top" Height="4" Margin="0,32,0,0"
                     Foreground="{StaticResource BrushAccent}" Background="{StaticResource BrushSurface}"/>
    </Grid>
</Window>
